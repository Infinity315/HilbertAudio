<!DOCTYPE html>
<script type="text/javascript" src="./scripts/d3.v5.min.js"></script>
<script type="text/javascript" src="./scripts/hilbertutils.js"></script>
<script type="text/javascript" src="./scripts/audioutils.js"></script>
<link rel="stylesheet" href="style.css">

<h1>D3 Visualization of a 4x4 Hilbert curve</h1>


<body>
    <label> Choose a file to be 'Hilbertized' and listened to</label>
    <div id="curve" class="graph"></div>

    

    <div>
        <input type="file"
            id="image" name="image"
            accept="image/png, image/jpeg"
            oninput="console.log('got file!');">
        <input type="range" 
            value="4" 
            id="orderInputId" 
            min="1" max="8" 
            step="1" 
            oninput="orderOutputId.value = orderInputId.value; updateOrder(orderInputId.value);">  
        <output> Order: </output><output id="orderOutputId">4</output>
    </div>
    
    
</body>


<script type="text/javascript">

    var width = 600;
    var height = 600;
    var initial_order = 4;
    var audioCtx = new AudioContext();

    var svg = d3.select("#curve").append("svg")
        .attr("width", width)
        .attr("height", height);

    svg.append("rect")
        .attr('width', "100%") 
        .attr("height", "100%")
        .attr("fill", 'grey')
        .attr('opacity', '25%');
    
    var path = svg.append("path")
        .style("stroke", "black")
        .style("stroke-width", 64 / 2**initial_order)
        .style("opacity", 0.25)
        .style("fill", "none")
        .attr("d", generatePath(2**initial_order, width));
    
    var len = path.node().getTotalLength();

    var arr = [],
        volume = 0.2,
        seconds = 2.0,
        tone = 441
  
    for (var i = 0; i < audioCtx.sampleRate * seconds; i++) {
        arr[i] = sineWaveAt(i, tone, audioCtx) * volume
    }

    function updateOrder(newOrder)
    {
        //playSound(arr, audioCtx);
        path.style("stroke", "black")
            .style("stroke-width", 64 / 2**newOrder)
            .style("opacity", 0.25)
            .style("fill", "none")
            .attr("d", generatePath(2**newOrder, width))
            .interrupt();

        len = path.node().getTotalLength();

        path.attr('stroke-dasharray', len + " " + len)
            .attr("stroke-dashoffset", len)
            .transition()
            .duration(2000)
            .attr('stroke-dashoffset', 0);
        
    }

    function updatebg() {

    }



</script>

</html>